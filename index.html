<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Send Data with File</title>
  <script>
    // Function to send data with a file
    async function sendData() {
      // Create a FormData object to send data and file
      const formData = new FormData();

      // Create a JavaScript object for the data
     

      // Convert the data object to a JSON string and append it to FormData

      // Get the file input element and select the first file
      const fileInput = document.getElementById("fileInput");
      const file = fileInput.files[0];  // Get the first file selected
    // formData.append('gpxs', [file, file]);
    if(file != null){
        formData.append('gpxs', file);
        formData.append('gpxs', file);
    }else{
    }
 
      formData.append('config', 

      JSON.stringify({
        "osm_files": ['trebic'],
        "map_area":[{"area": "trebic, Česko",
        "plot": false}, {"area": "Trnava, Česko", "plot":false},
        {"area":"Horní vilémovice, Česko", "plot": false, 'category':0},],
        "paper_dimensions": [270, 210],
        "paper_preview_dimensions":[100,100],
        "fit_paper_size": true,
        "fit_paper_size_bounds_plot": false,
        "plot_bridges": false,
        "plot_tunnels": false,
        "gpxs_categories": {},
        "map_theme": "mapycz",
        "min_place_population": 0,
        "peaks_filter_sensitivity":0,
        'gpxs_styles':{
          'file_names':{},
          'categories':{},
          'general':{'color': "red", 'marker_layer_position': "above_text",
            'start_marker': "mpl_start", 'finish_marker':"fa_finish"
          }
        },
        'wanted_categories_and_styles_edit':{
          'nodes':{
            'natural': {'peak':{}},
          },
          'ways':{
            'highway':{
              'primary': {},
              'secondary': {}
            }},
          'areas':{},
        },
        'styles_zoom_levels':{
          "nodes": 5,
          "ways": 5,
          "areas": 5,
          "general": 5
        },
     
      }
      ));

      // Send the data using the fetch API to FastAPI endpoint
      try {
        const response = await fetch('http://localhost:8000/generate-map-normal/', {
        // const response = await fetch('http://localhost:8000/generate_map_preview/', {
          method: 'POST',
          body: formData,

        });

        // Parse the JSON response from FastAPI
        const result = await response.json();

        // Log the result to the console
        console.log('Response:', result);
      } catch (error) {
        console.error('Error:', error);
      }
    }
    async function get() {
      try {
        const response = await fetch('http://localhost:8000/tasks/', {
        });

        // Parse the JSON response from FastAPI
        const result = await response.json();

        // Log the result to the console
        console.log('Response:', result);
      } catch (error) {
        console.error('Error:', error);
      }
    }
  </script>
</head>
<body>

  <h1>Upload File and Data</h1>

  <!-- File input for selecting the file -->
  <input type="file" id="fileInput" />
  
  <!-- Button to trigger the sendData function -->
  <button onclick="sendData()">Send Data</button>
  <button onclick="get()"> get</button>

</body>
</html>
